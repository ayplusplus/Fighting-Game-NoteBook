<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ game_name }} - Notebook</title>
    <style>
        body {
            font-family: Lato, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;

            /* Dynamic background based on game */
            {% if game == 'mk1' %}
                /* Mortal Kombat - Dark red and black theme */
                background: linear-gradient(135deg, #1a0000 0%, #4a0000 25%, #1a0000 50%, #300000 75%, #1a0000 100%);
                background-attachment: fixed;
            {% elif game == 'sf6' %}
                /* Street Fighter - Blue and yellow energy theme */
                background: linear-gradient(135deg, #0a1628 0%, #1e3a5f 25%, #2c5f9e 50%, #1e3a5f 75%, #0a1628 100%);
                background-attachment: fixed;
            {% elif game == '2xko' %}
                /* 2XKO - Hextech blue and gold theme */
                background: linear-gradient(135deg, #0a1420 0%, #1a2f4a 25%, #0f4d6e 50%, #1a2f4a 75%, #0a1420 100%);
                background-attachment: fixed;
            {% endif %}
        }

        .header {
            {% if game == 'mk1' %}
                background: linear-gradient(90deg, #1a0000 0%, #8b0000 50%, #1a0000 100%);
                border-bottom: 3px solid #ff0000;
            {% elif game == 'sf6' %}
                background: linear-gradient(90deg, #1e3a5f 0%, #4a90e2 50%, #1e3a5f 100%);
                border-bottom: 3px solid #ffd700;
            {% elif game == '2xko' %}
                background: linear-gradient(90deg, #0a1420 0%, #0f4d6e 50%, #0a1420 100%);
                border-bottom: 3px solid #00d4ff;
            {% endif %}
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .header h1 {
            margin: 0;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            {% if game == 'mk1' %}
                color: #ff0000;
            {% elif game == 'sf6' %}
                color: #ffd700;
            {% elif game == '2xko' %}
                color: #00d4ff;
            {% endif %}
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        .header-buttons a, .header-buttons button {
            padding: 8px 16px;
            background-color: #555;
            color: white;
            text-decoration: none;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .header-buttons a:hover, .header-buttons button:hover {
            background-color: #777;
            transform: translateY(-2px);
        }

        .save-btn {
            {% if game == 'mk1' %}
                background-color: #8b0000 !important;
            {% elif game == 'sf6' %}
                background-color: #4a90e2 !important;
            {% elif game == '2xko' %}
                background-color: #0f4d6e !important;
            {% endif %}
        }

        .save-btn:hover {
            {% if game == 'mk1' %}
                background-color: #b30000 !important;
            {% elif game == 'sf6' %}
                background-color: #5fa3f5 !important;
            {% elif game == '2xko' %}
                background-color: #1a6a8e !important;
            {% endif %}
        }

        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .notebook-info {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            {% if game == 'mk1' %}
                border-left: 4px solid #ff0000;
            {% elif game == 'sf6' %}
                border-left: 4px solid #ffd700;
            {% elif game == '2xko' %}
                border-left: 4px solid #00d4ff;
            {% endif %}
        }

        .notebook-info p {
            margin: 5px 0;
            color: #333;
        }

        .character-selector {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            {% if game == 'mk1' %}
                border-left: 4px solid #ff0000;
            {% elif game == 'sf6' %}
                border-left: 4px solid #ffd700;
            {% elif game == '2xko' %}
                border-left: 4px solid #00d4ff;
            {% endif %}
        }

        .character-selector label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }

        .character-selector select {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 4px;
            background-color: white;
            cursor: pointer;
        }

        .character-selector select:focus {
            outline: none;
            {% if game == 'mk1' %}
                border-color: #ff0000;
            {% elif game == 'sf6' %}
                border-color: #4a90e2;
            {% elif game == '2xko' %}
                border-color: #00d4ff;
            {% endif %}
        }

        .character-selector option.has-notes {
            {% if game == 'mk1' %}
                background-color: #ffe6e6;
            {% elif game == 'sf6' %}
                background-color: #e6f2ff;
            {% elif game == '2xko' %}
                background-color: #e6f7ff;
            {% endif %}
            font-weight: bold;
        }

        .notebook-area {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            {% if game == 'mk1' %}
                border-left: 4px solid #ff0000;
            {% elif game == 'sf6' %}
                border-left: 4px solid #ffd700;
            {% elif game == '2xko' %}
                border-left: 4px solid #00d4ff;
            {% endif %}
        }

        .notebook-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        .notebook-header h2 {
            margin: 0;
            color: #333;
        }

        .character-count {
            font-size: 14px;
            color: #666;
        }

        textarea {
            width: 100%;
            min-height: 500px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            box-sizing: border-box;
            background-color: white;
        }

        textarea:focus {
            outline: none;
            {% if game == 'mk1' %}
                border-color: #ff0000;
            {% elif game == 'sf6' %}
                border-color: #4a90e2;
            {% elif game == '2xko' %}
                border-color: #00d4ff;
            {% endif %}
        }

        .save-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }

        .save-status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .save-status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .quick-tips {
            {% if game == 'mk1' %}
                background-color: rgba(139, 0, 0, 0.1);
                border: 2px solid #ff0000;
            {% elif game == 'sf6' %}
                background-color: rgba(74, 144, 226, 0.1);
                border: 2px solid #ffd700;
            {% elif game == '2xko' %}
                background-color: rgba(0, 212, 255, 0.1);
                border: 2px solid #00d4ff;
            {% endif %}
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .quick-tips h3 {
            margin-top: 0;
            {% if game == 'mk1' %}
                color: #8b0000;
            {% elif game == 'sf6' %}
                color: #1e3a5f;
            {% elif game == '2xko' %}
                color: #0a1420;
            {% endif %}
        }

        .quick-tips ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .quick-tips li {
            margin: 5px 0;
            {% if game == 'mk1' %}
                color: #4a0000;
            {% elif game == 'sf6' %}
                color: #1e3a5f;
            {% elif game == '2xko' %}
                color: #0a1420;
            {% endif %}
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>{{ game_name }} Notebook</h1>
        <div class="header-buttons">
            <button class="save-btn" onclick="saveNotes()">Save Notes</button>
            <a href="{{ url_for('dashboard') }}">Back to Dashboard</a>
            <a href="{{ url_for('logout') }}">Logout</a>
        </div>
    </div>

    <div class="container">
        <div class="notebook-info">
            <p><strong>User:</strong> {{ username }}</p>
            <p><strong>Game:</strong> {{ game_name }}</p>
            <p><strong>Character:</strong> {{ selected_character }}</p>
        </div>

        <div class="character-selector">
            <label for="characterSelect">Switch Character:</label>
            <select id="characterSelect" onchange="changeCharacter()">
                {% for character in characters %}
                    <option value="{{ character }}"
                            {% if character == selected_character %}selected{% endif %}
                            {% if character in characters_with_notes %}class="has-notes"{% endif %}>
                        {{ character }}{% if character in characters_with_notes %} âœ“{% endif %}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="notebook-area">
            <div class="notebook-header">
                <h2>Notes for {{ selected_character }}</h2>
                <span class="character-count" id="charCount">0 characters</span>
            </div>
            <textarea id="notesTextarea" placeholder="Write your notes for {{ selected_character }} here...

Some ideas:
- Combos and bread-and-butter attacks
- Frame data and punishes
- Matchup notes against other characters
- Strategy and game plan
- Special moves and their uses">{{ notes }}</textarea>
            <div id="saveStatus" class="save-status"></div>
        </div>

        <div class="quick-tips">
            <h3>ðŸ’¡ Quick Tips</h3>
            <ul>
                <li>Characters with a âœ“ have saved notes</li>
                <li>Press Ctrl+S (Cmd+S on Mac) to quickly save</li>
                <li>Notes auto-save every 30 seconds</li>
                <li>Switch characters anytime - your notes are saved separately for each</li>
            </ul>
        </div>
    </div>

    <script>
        let currentCharacter = "{{ selected_character }}";
        let unsavedChanges = false;

        // Update character count
        function updateCharCount() {
            const textarea = document.getElementById('notesTextarea');
            const count = textarea.value.length;
            document.getElementById('charCount').textContent = `${count} characters`;
        }

        // Track changes
        document.getElementById('notesTextarea').addEventListener('input', function() {
            unsavedChanges = true;
            updateCharCount();
        });

        // Initial count
        updateCharCount();

        function changeCharacter() {
            const select = document.getElementById('characterSelect');
            const newCharacter = select.value;

            if (unsavedChanges) {
                if (!confirm('You have unsaved changes. Do you want to switch characters without saving?')) {
                    select.value = currentCharacter;
                    return;
                }
            }

            // Navigate to new character's notebook
            window.location.href = `/notebook/{{ game }}/${encodeURIComponent(newCharacter)}`;
        }

        function saveNotes() {
            const content = document.getElementById('notesTextarea').value;
            const statusDiv = document.getElementById('saveStatus');
            const character = "{{ selected_character }}";

            fetch("{{ url_for('save_notes_route') }}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `game={{ game }}&character=${encodeURIComponent(character)}&content=${encodeURIComponent(content)}`
            })
            .then(response => response.json())
            .then(data => {
                statusDiv.textContent = data.message;
                statusDiv.className = 'save-status ' + (data.success ? 'success' : 'error');
                statusDiv.style.display = 'block';
                unsavedChanges = false;

                // Update the dropdown to show checkmark
                if (data.success && content.trim().length > 0) {
                    const option = document.querySelector(`option[value="${character}"]`);
                    if (option && !option.classList.contains('has-notes')) {
                        option.classList.add('has-notes');
                        option.textContent = character + ' âœ“';
                    }
                }

                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
            })
            .catch(error => {
                statusDiv.textContent = 'Error saving notes';
                statusDiv.className = 'save-status error';
                statusDiv.style.display = 'block';
            });
        }

        // Auto-save every 30 seconds
        setInterval(() => {
            if (unsavedChanges) {
                saveNotes();
            }
        }, 30000);

        // Save on Ctrl+S
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                saveNotes();
            }
        });

        // Warn before leaving with unsaved changes
        window.addEventListener('beforeunload', (e) => {
            if (unsavedChanges) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>